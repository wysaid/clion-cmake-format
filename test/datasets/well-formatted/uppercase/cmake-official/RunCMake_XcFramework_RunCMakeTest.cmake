INCLUDE(RunCMake)

IF (RunCMake_GENERATOR STREQUAL "Xcode")
    SET(maybe_ios_catalyst "")
ELSE ()
    SET(maybe_ios_catalyst ios-catalyst)
ENDIF ()

FUNCTION(create_library type platform system_name archs sysroot)
    SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/create-${type}-${platform}-build)
    RUN_CMAKE_WITH_OPTIONS(create-${type}-${platform} -DCMAKE_SYSTEM_NAME=${system_name} -DCMAKE_OSX_ARCHITECTURES=${archs} -DCMAKE_OSX_SYSROOT=${sysroot} -DCMAKE_INSTALL_PREFIX=${RunCMake_TEST_BINARY_DIR}/install)

    SET(RunCMake_TEST_NO_CLEAN 1)
    RUN_CMAKE_COMMAND(create-${type}-${platform}-build ${CMAKE_COMMAND} --build . --config Release)
    RUN_CMAKE_COMMAND(create-${type}-${platform}-install ${CMAKE_COMMAND} --install . --config Release)
ENDFUNCTION()

FUNCTION(create_libraries type)
    CREATE_LIBRARY(${type} macos Darwin "${macos_archs_2}" macosx)
    CREATE_LIBRARY(${type} ios iOS "arm64" iphoneos)
    IF (maybe_ios_catalyst)
        CREATE_LIBRARY(${type} ios-catalyst iOS "${macos_archs_2}" macosx)
    ENDIF ()
    CREATE_LIBRARY(${type} tvos tvOS "arm64" appletvos)
    CREATE_LIBRARY(${type} watchos watchOS "armv7k\\\\;arm64_32" watchos)
    IF (CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 15.2)
        CREATE_LIBRARY(${type} visionos visionOS "arm64" xros)
    ENDIF ()
    CREATE_LIBRARY(${type} ios-simulator iOS "${macos_archs_2}" iphonesimulator)
    CREATE_LIBRARY(${type} tvos-simulator tvOS "${macos_archs_2}" appletvsimulator)
    CREATE_LIBRARY(${type} watchos-simulator watchOS "${watch_sim_archs_2}" watchsimulator)
    IF (CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 15.2)
        CREATE_LIBRARY(${type} visionos-simulator visionOS "${macos_archs_2}" xrsimulator)
    ENDIF ()
ENDFUNCTION()

FUNCTION(create_xcframework name type platforms)
    SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/create-xcframework-${name}-build)
    IF (CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 15)
        # 'xcodebuild -create-xcframework' fails on symlinked paths.
        FILE(REAL_PATH "${RunCMake_SOURCE_DIR}" src_dir)
        FILE(REAL_PATH "${RunCMake_BINARY_DIR}" bld_dir)
    ELSE ()
        SET(src_dir "${RunCMake_SOURCE_DIR}")
        SET(bld_dir "${RunCMake_BINARY_DIR}")
    ENDIF ()
    SET(args)
    FOREACH (platform IN LISTS platforms)
        SET(lib_dir "${bld_dir}/create-${type}-${platform}-build/install/lib")
        IF (type STREQUAL "framework")
            LIST(APPEND args -framework ${lib_dir}/mylib.framework)
        ELSE ()
            LIST(APPEND args -library ${lib_dir}/libmylib.a -headers ${src_dir}/mylib/include)
        ENDIF ()
    ENDFOREACH ()
    RUN_CMAKE_COMMAND(create-xcframework-${name} xcodebuild -create-xcframework ${args} -output ${RunCMake_TEST_BINARY_DIR}/mylib.xcframework)
ENDFUNCTION()

FUNCTION(create_executable name xcfname system_name archs sysroot)
    SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/create-executable-${name}-build)
    RUN_CMAKE_WITH_OPTIONS(create-executable-${name} -DCMAKE_SYSTEM_NAME=${system_name} -DCMAKE_OSX_ARCHITECTURES=${archs} -DCMAKE_OSX_SYSROOT=${sysroot} -DMYLIB_LIBRARY=${RunCMake_BINARY_DIR}/create-xcframework-${xcfname}-build/mylib.xcframework)

    SET(RunCMake_TEST_NO_CLEAN 1)
    RUN_CMAKE_COMMAND(create-executable-${name}-build ${CMAKE_COMMAND} --build . --config Release)
ENDFUNCTION()

FUNCTION(create_executables name type)
    CREATE_EXECUTABLE(${name}-macos ${type} Darwin "${macos_archs_2}" macosx)
    CREATE_EXECUTABLE(${name}-ios ${type} iOS "arm64" iphoneos)
    IF (maybe_ios_catalyst)
        CREATE_EXECUTABLE(${name}-ios-catalyst ${type} iOS "${macos_archs_2}" macosx)
    ENDIF ()
    CREATE_EXECUTABLE(${name}-tvos ${type} tvOS "arm64" appletvos)
    CREATE_EXECUTABLE(${name}-watchos ${type} watchOS "armv7k\\\\;arm64_32" watchos)
    IF (CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 15.2)
        CREATE_EXECUTABLE(${name}-visionos ${type} visionOS "arm64" xros)
    ENDIF ()
    CREATE_EXECUTABLE(${name}-ios-simulator ${type} iOS "${macos_archs_2}" iphonesimulator)
    CREATE_EXECUTABLE(${name}-tvos-simulator ${type} tvOS "${macos_archs_2}" appletvsimulator)
    CREATE_EXECUTABLE(${name}-watchos-simulator ${type} watchOS "${watch_sim_archs_2}" watchsimulator)
    IF (CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 15.2)
        CREATE_EXECUTABLE(${name}-visionos-simulator ${type} visionOS "${macos_archs_2}" xrsimulator)
    ENDIF ()
ENDFUNCTION()

SET(xcframework_platforms macos ios ${maybe_ios_catalyst} tvos watchos ios-simulator tvos-simulator watchos-simulator)
IF (CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 15.2)
    LIST(APPEND xcframework_platforms visionos visionos-simulator)
ENDIF ()
IF (CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 12 AND NOT RunCMake_GENERATOR STREQUAL "FASTBuild")
    SET(macos_archs_1 "x86_64\\;arm64")
    SET(macos_archs_2 "x86_64\\\\;arm64")
    SET(watch_sim_archs_2 "x86_64")
ELSE ()
    SET(macos_archs_1 "x86_64")
    SET(macos_archs_2 "x86_64")
    SET(watch_sim_archs_2 "i386")
ENDIF ()

CREATE_LIBRARIES(library)
CREATE_LIBRARIES(framework)
CREATE_XCFRAMEWORK(library library "${xcframework_platforms}")
CREATE_XCFRAMEWORK(framework framework "${xcframework_platforms}")
CREATE_XCFRAMEWORK(incomplete framework "tvos;watchos")
CREATE_EXECUTABLES(library library)
CREATE_EXECUTABLES(framework framework)
RUN_CMAKE_WITH_OPTIONS(create-executable-incomplete -DCMAKE_SYSTEM_NAME=Darwin "-DCMAKE_OSX_ARCHITECTURES=${macos_archs_1}" -DCMAKE_OSX_SYSROOT=macosx -DMYLIB_LIBRARY=${RunCMake_BINARY_DIR}/create-xcframework-incomplete-build/mylib.xcframework)
CREATE_EXECUTABLES(target-library library)
CREATE_EXECUTABLES(target-framework framework)
RUN_CMAKE_WITH_OPTIONS(create-executable-target-incomplete -DCMAKE_SYSTEM_NAME=Darwin "-DCMAKE_OSX_ARCHITECTURES=${macos_archs_1}" -DCMAKE_OSX_SYSROOT=macosx -DMYLIB_LIBRARY=${RunCMake_BINARY_DIR}/create-xcframework-incomplete-build/mylib.xcframework)
IF (RunCMake_GENERATOR STREQUAL "Xcode" AND CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 12)
    CREATE_EXECUTABLES(library-link-phase library)
    CREATE_EXECUTABLES(framework-link-phase framework)
    RUN_CMAKE_WITH_OPTIONS(create-executable-incomplete-link-phase -DCMAKE_SYSTEM_NAME=Darwin "-DCMAKE_OSX_ARCHITECTURES=${macos_archs_1}" -DCMAKE_OSX_SYSROOT=macosx -DMYLIB_LIBRARY=${RunCMake_BINARY_DIR}/create-xcframework-incomplete-build/mylib.xcframework)
    CREATE_EXECUTABLES(target-library-link-phase library)
    CREATE_EXECUTABLES(target-framework-link-phase framework)
    RUN_CMAKE_WITH_OPTIONS(create-executable-target-incomplete-link-phase -DCMAKE_SYSTEM_NAME=Darwin "-DCMAKE_OSX_ARCHITECTURES=${macos_archs_1}" -DCMAKE_OSX_SYSROOT=macosx -DMYLIB_LIBRARY=${RunCMake_BINARY_DIR}/create-xcframework-incomplete-build/mylib.xcframework)
ENDIF ()

# Ensure that .xcframework is found before .framework
SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/create-xcframework-framework-build)
SET(RunCMake_TEST_NO_CLEAN 1)
RUN_CMAKE_COMMAND(copy-framework ${CMAKE_COMMAND} -E copy_directory ${RunCMake_BINARY_DIR}/create-framework-macos-build/install/lib/mylib.framework ${RunCMake_TEST_BINARY_DIR}/mylib.framework)
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

RUN_CMAKE(find-library)
RUN_CMAKE_COMMAND(find-library-script ${CMAKE_COMMAND} -P ${RunCMake_SOURCE_DIR}/find-library.cmake)

FILE(REMOVE_RECURSE ${RunCMake_BINARY_DIR}/export-install)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/export-macos-build)
RUN_CMAKE_WITH_OPTIONS(export-macos -DCMAKE_SYSTEM_NAME=Darwin -DCMAKE_INSTALL_PREFIX=${RunCMake_BINARY_DIR}/export-install)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(export-macos-build ${CMAKE_COMMAND} --build . ${_config_arg})
RUN_CMAKE_COMMAND(export-macos-install ${CMAKE_COMMAND} --install . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/export-ios-build)
RUN_CMAKE_WITH_OPTIONS(export-ios -DCMAKE_SYSTEM_NAME=iOS -DCMAKE_OSX_SYSROOT=iphoneos "-DCMAKE_OSX_ARCHITECTURES=arm64" -DCMAKE_INSTALL_PREFIX=${RunCMake_BINARY_DIR}/export-install)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(export-ios-build ${CMAKE_COMMAND} --build . ${_config_arg})
RUN_CMAKE_COMMAND(export-ios-install ${CMAKE_COMMAND} --install . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

IF (maybe_ios_catalyst)
    SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/export-ios-catalyst-build)
    RUN_CMAKE_WITH_OPTIONS(export-ios-catalyst -DCMAKE_SYSTEM_NAME=iOS -DCMAKE_OSX_SYSROOT=macosx "-DCMAKE_OSX_ARCHITECTURES=${macos_archs_1}" -DCMAKE_INSTALL_PREFIX=${RunCMake_BINARY_DIR}/export-install)
    SET(RunCMake_TEST_NO_CLEAN 1)
    SET(_config_arg)
    IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
        SET(_config_arg --config Release)
    ENDIF ()
    RUN_CMAKE_COMMAND(export-ios-catalyst-build ${CMAKE_COMMAND} --build . ${_config_arg})
    RUN_CMAKE_COMMAND(export-ios-catalyst-install ${CMAKE_COMMAND} --install . ${_config_arg})
    UNSET(RunCMake_TEST_NO_CLEAN)
    UNSET(RunCMake_TEST_BINARY_DIR)
ENDIF ()

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/export-ios-simulator-build)
RUN_CMAKE_WITH_OPTIONS(export-ios-simulator -DCMAKE_SYSTEM_NAME=iOS -DCMAKE_OSX_SYSROOT=iphonesimulator "-DCMAKE_OSX_ARCHITECTURES=${macos_archs_1}" -DCMAKE_INSTALL_PREFIX=${RunCMake_BINARY_DIR}/export-install)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(export-ios-simulator-build ${CMAKE_COMMAND} --build . ${_config_arg})
RUN_CMAKE_COMMAND(export-ios-simulator-install ${CMAKE_COMMAND} --install . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/import-macos-install-specific-no-xcframework-build)
RUN_CMAKE_WITH_OPTIONS(import-macos-install-specific-no-xcframework -DCMAKE_SYSTEM_NAME=Darwin -Dmylib_DIR=${RunCMake_BINARY_DIR}/export-install/lib/macos/cmake/mylib)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
SET(_config_dir)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
    SET(_config_dir /Release)
ENDIF ()
RUN_CMAKE_COMMAND(import-macos-install-specific-no-xcframework-build ${CMAKE_COMMAND} --build . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_NO_CLEAN 1)
IF (CMake_TEST_XCODE_VERSION VERSION_GREATER_EQUAL 15)
    # 'xcodebuild -create-xcframework' fails on symlinked paths.
    FILE(REAL_PATH "${RunCMake_SOURCE_DIR}" src_dir)
    FILE(REAL_PATH "${RunCMake_BINARY_DIR}" bld_dir)
ELSE ()
    SET(src_dir "${RunCMake_SOURCE_DIR}")
    SET(bld_dir "${RunCMake_BINARY_DIR}")
ENDIF ()
IF (maybe_ios_catalyst)
    SET(maybe_ios_catalyst_mylib
        -library ${bld_dir}/export-install/lib/ios-catalyst/libmylib.a
        -headers ${src_dir}/mylib/include
    )
    SET(maybe_ios_catalyst_mylib_genex
        -library ${bld_dir}/export-install/lib/ios-catalyst/libmylib-genex.a
        -headers ${src_dir}/mylib/include
    )
ELSE ()
    SET(maybe_ios_catalyst_mylib "")
    SET(maybe_ios_catalyst_mylib_genex "")
ENDIF ()
SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/export-install)
RUN_CMAKE_COMMAND(export-install-xcframework xcodebuild -create-xcframework
    -output ${bld_dir}/export-install/lib/mylib.xcframework
    -library ${bld_dir}/export-install/lib/macos/libmylib.a
    -headers ${src_dir}/mylib/include
    -library ${bld_dir}/export-install/lib/ios/libmylib.a
    -headers ${src_dir}/mylib/include
    ${maybe_ios_catalyst_mylib}
    -library ${bld_dir}/export-install/lib/ios-simulator/libmylib.a
    -headers ${src_dir}/mylib/include
)
RUN_CMAKE_COMMAND(export-install-xcframework-genex xcodebuild -create-xcframework
    -output ${bld_dir}/export-install/lib2/mylib-genex.xcframework
    -library ${bld_dir}/export-install/lib/macos/libmylib-genex.a
    -headers ${src_dir}/mylib/include
    -library ${bld_dir}/export-install/lib/ios/libmylib-genex.a
    -headers ${src_dir}/mylib/include
    ${maybe_ios_catalyst_mylib_genex}
    -library ${bld_dir}/export-install/lib/ios-simulator/libmylib-genex.a
    -headers ${src_dir}/mylib/include
)
SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/export-macos-build)
RUN_CMAKE_COMMAND(export-build-macos-xcframework xcodebuild -create-xcframework
    -output ${bld_dir}/export-macos-build/lib/mylib.xcframework
    -library ${bld_dir}/export-macos-build/lib/macos${_config_dir}/libmylib.a
    -headers ${src_dir}/mylib/include
)
RUN_CMAKE_COMMAND(export-build-macos-xcframework-genex xcodebuild -create-xcframework
    -output ${bld_dir}/export-macos-build/lib/mylib-genex.xcframework
    -library ${bld_dir}/export-macos-build/lib/macos${_config_dir}/libmylib-genex.a
    -headers ${src_dir}/mylib/include
)
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/import-macos-install-specific-build)
RUN_CMAKE_WITH_OPTIONS(import-macos-install-specific -DCMAKE_SYSTEM_NAME=Darwin -Dmylib_DIR=${RunCMake_BINARY_DIR}/export-install/lib/macos/cmake/mylib)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(import-macos-install-specific-build ${CMAKE_COMMAND} --build . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/import-macos-build-specific-build)
RUN_CMAKE_WITH_OPTIONS(import-macos-build-specific -DCMAKE_SYSTEM_NAME=Darwin -Dmylib_DIR=${RunCMake_BINARY_DIR}/export-macos-build/lib/macos/cmake/mylib)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(import-macos-build-specific-build ${CMAKE_COMMAND} --build . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/import-macos-install-specific-genex-build)
RUN_CMAKE_WITH_OPTIONS(import-macos-install-specific-genex -DCMAKE_SYSTEM_NAME=Darwin -Dmylib_DIR=${RunCMake_BINARY_DIR}/export-install/lib/macos/cmake/mylib)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(import-macos-install-specific-genex-build ${CMAKE_COMMAND} --build . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/import-macos-build-specific-genex-build)
RUN_CMAKE_WITH_OPTIONS(import-macos-build-specific-genex -DCMAKE_SYSTEM_NAME=Darwin -Dmylib_DIR=${RunCMake_BINARY_DIR}/export-macos-build/lib/macos/cmake/mylib)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(import-macos-build-specific-genex-build ${CMAKE_COMMAND} --build . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/import-macos-install-general-build)
RUN_CMAKE_WITH_OPTIONS(import-macos-install-general -DCMAKE_SYSTEM_NAME=Darwin -Dmylib_DIR=${RunCMake_BINARY_DIR}/export-install/lib/cmake/mylib)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(import-macos-install-general-build ${CMAKE_COMMAND} --build . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/import-macos-build-general-build)
RUN_CMAKE_WITH_OPTIONS(import-macos-build-general -DCMAKE_SYSTEM_NAME=Darwin -Dmylib_DIR=${RunCMake_BINARY_DIR}/export-macos-build/lib/cmake/mylib)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(import-macos-build-general-build ${CMAKE_COMMAND} --build . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)

SET(RunCMake_TEST_BINARY_DIR ${RunCMake_BINARY_DIR}/import-ios-install-general-build)
RUN_CMAKE_WITH_OPTIONS(import-ios-install-general -DCMAKE_SYSTEM_NAME=iOS -DCMAKE_OSX_SYSROOT=iphoneos -DCMAKE_OSX_ARCHITECTURES=arm64 -Dmylib_DIR=${RunCMake_BINARY_DIR}/export-install/lib/cmake/mylib)
SET(RunCMake_TEST_NO_CLEAN 1)
SET(_config_arg)
IF (RunCMake_GENERATOR_IS_MULTI_CONFIG)
    SET(_config_arg --config Release)
ENDIF ()
RUN_CMAKE_COMMAND(import-ios-install-general-build ${CMAKE_COMMAND} --build . ${_config_arg})
UNSET(RunCMake_TEST_NO_CLEAN)
UNSET(RunCMake_TEST_BINARY_DIR)
